<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup Database Skema - Donuts.Inc</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-6">

    <div class="max-w-md w-full bg-white rounded-[2.5rem] p-8 shadow-xl text-center space-y-6">
        <div class="bg-emerald-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto">
            <i data-lucide="database" class="text-emerald-600 w-10 h-10"></i>
        </div>
        
        <div>
            <h2 class="text-2xl font-black text-slate-900">Backup Skema DB</h2>
            <p class="text-slate-500 text-sm mt-2">Gunakan file ini untuk menyimpan struktur tabel database Anda sebagai cadangan.</p>
        </div>

        <div class="space-y-3">
            <button onclick="downloadDatabaseSchema()" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-emerald-200 hover:bg-emerald-700 transition-all flex items-center justify-center gap-3">
                <i data-lucide="download" class="w-5 h-5"></i>
                Unduh Struktur (.sql)
            </button>
            
            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest">Mencakup 10 Tabel Utama</p>
        </div>
        
        <div class="text-left bg-slate-50 p-4 rounded-2xl border border-slate-100">
            <p class="text-[9px] font-black text-slate-400 uppercase mb-2">Daftar Tabel Terdeteksi:</p>
            <ul class="text-[11px] font-bold text-slate-600 grid grid-cols-2 gap-1">
                <li>• pesanan_pelanggan</li>
                <li>• produk</li>
                <li>• bahan</li>
                <li>• transaksi</li>
                <li>• bank_payment</li>
                <li>• settings</li>
                <li>• resep</li>
                <li>• profil</li>
                <li>• riwayat_penyesuaian</li>
                <li>• riwayat_pembelian</li>
            </ul>
        </div>
    </div>

    <script>
        function downloadDatabaseSchema() {
            const schemaSQL = `-- BACKUP STRUKTUR DATABASE - DONUTS.INC
-- Dihasilkan pada: ${new Date().toLocaleString('id-ID')}
-- Metode: Manual-Otomatis (Schema Blueprint)

-- 1. Tabel Produk
CREATE TABLE produk (
  id int4 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  nama text NOT NULL,
  harga numeric NOT NULL,
  stok int4,
  image_url text
);

-- 2. Tabel Bahan
CREATE TABLE bahan (
  id int4 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  nama_bahan text,
  stok_gram int4,
  satuan text,
  harga_beli_per_gram numeric
);

-- 3. Tabel Transaksi
CREATE TABLE transaksi (
  id int4 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  created_at timestamptz DEFAULT now(),
  total_harga numeric,
  total_qty int4,
  detail_item text,
  bank_id int4,
  pajak_nominal numeric,
  diskon_nominal numeric,
  items jsonb
);

-- 4. Tabel Bank Payment
CREATE TABLE bank_payment (
  id int4 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  nama_metode text,
  nomor_rekening text,
  aktif bool
);

-- 5. Tabel Settings
CREATE TABLE settings (
  id int4 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  key text,
  value numeric
);

-- 6. Tabel Resep
CREATE TABLE resep (
  id int4 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  produk_id int4,
  bahan_id int4,
  jumlah_dibutuhkan int4
);

-- 7. Tabel Profil
CREATE TABLE profil (
  id uuid PRIMARY KEY,
  nama_lengkap text,
  role text,
  updated_at timestamptz,
  email text
);

-- 8. Tabel Pesanan Pelanggan
CREATE TABLE pesanan_pelanggan (
  id int8 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  created_at timestamptz DEFAULT now(),
  nomor_meja text,
  nama_pelanggan text,
  items jsonb,
  total_harga numeric,
  status text,
  tipe_order text,
  metode_bayar text,
  alamat_kirim text,
  bukti_bayar_url text,
  nomor_whatsapp text,
  dibatalkan_oleh text
);

-- 9. Tabel Riwayat Penyesuaian
CREATE TABLE riwayat_penyesuaian (
  id int8 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  created_at timestamptz DEFAULT now(),
  bahan_id int4,
  stok_sebelumnya numeric,
  stok_fisik numeric,
  selisih numeric,
  keterangan text
);

-- 10. Tabel Riwayat Pembelian
CREATE TABLE riwayat_pembelian (
  id int8 PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  created_at timestamptz DEFAULT now(),
  bahan_id int4,
  jumlah numeric,
  total_harga numeric,
  supplier text,
  catatan text
);`;

            const blob = new Blob([schemaSQL], { type: 'text/sql' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "Backup_Skema_Database_DonutsInc.sql";
            link.click();
            
            alert("Berhasil! Simpan file .sql ini di tempat aman.");
        }
        
        lucide.createIcons();
    </script>
</body>
</html>
